<%- include('partials/head') -%>
<%- include('partials/nav') -%>
<main>
  
    <section style="margin: 0 auto; padding: 0 10px; max-width: 1100px;">

        <section style="max-width: 1100px;" class="row">
            <h2 class="mt-3 mb-4">Profile</h2>
            <form action="/settings/updateSetting/?_method=PUT" enctype="multipart/form-data" method="POST" class="d-flex justify-content-end">

                <section class="col">
                    <label for="exampleFormControlInput1" class="form-label">Username</label>
                    <input type="text" class="form-control mb-5" id="exampleFormControlInput1" readonly value="<%= user.userName %>" style="background-color: #242832; border: none; color: white;">
        
                    <section class="row mb-5">
                        <label class="form-label">Avatar</label>
                        <div class="col-auto mt-auto">
                            <img src="<%= user.profilePic%>" alt="user profile picture" loading="lazy" style="width: 95px; height: 95px;">
                        </div>
                        <div class="col d-flex align-items-center">
                            <label for="avatar_upload" class="btn btn-primary">Select new avatar</label>
                            <input type="file" class="" id="avatar_upload" name="file" accept="image/jpg, image/jpeg, image/png" style="background-color: #242832; border: none; color: white; margin-bottom: 20px; display: none;">
                            <span id="file-name" style="margin-left: 20px"></span>
                        </div>
                    </section>
        
                    <label for="bio" class="form-label">Biography</label>
                    <textarea class="form-control" id="bio" name="bio" rows="7" placeholder="Add a bio..." style="background-color: #242832; border: none; color: white;"><%= user.bio %></textarea>
                </section>

                <section class="col" style="margin-left: 50px;">
                    <aside class="favorite-films">
                        <label>Favorite Films</label>
                        <ul style="list-style: none; padding-left: 0;" class="d-flex flex-wrap">
                            <li>
                                <% if(favFilms[0]) { %>
                                    <img src="<%= base_url + favFilms[0].moviePoster %>" alt="movie poster" loading="lazy" style="width: 110px; height: 165px;" data-bs-toggle="modal" data-bs-target="#favFilmModal" class="img-fluid rounded film fav_film" data-position="1">
                                <% } else { %>
                                    <button type="button" class="img-fluid rounded fav_film" data-bs-toggle="modal" data-bs-target="#favFilmModal" data-position="1">
                                        <i class="fa fa-plus-square"></i>
                                    </button>
                                <% } %>
                            </li>
                            <li>
                                <% if(favFilms[1]) { %>
                                    <img src="<%= base_url + favFilms[1].moviePoster %>" alt="movie poster" loading="lazy" style="width: 110px; height: 165px;" data-bs-toggle="modal" data-bs-target="#favFilmModal" class="img-fluid rounded film fav_film" data-position="2">
                                <% } else { %>
                                    <button type="button" class="img-fluid rounded fav_film" data-bs-toggle="modal" data-bs-target="#favFilmModal" data-position="2">
                                        <i class="fa fa-plus-square"></i>
                                    </button>
                                <% } %>
                            </li>
                            <li>
                                <% if(favFilms[2]) { %>
                                    <img src="<%= base_url + favFilms[2].moviePoster %>" alt="movie poster" loading="lazy" style="width: 110px; height: 165px;" data-bs-toggle="modal" data-bs-target="#favFilmModal" class="img-fluid rounded film fav_film" data-position="3">
                                <% } else { %>
                                    <button type="button" class="img-fluid rounded fav_film" data-bs-toggle="modal" data-bs-target="#favFilmModal" data-position="3">
                                        <i class="fa fa-plus-square"></i>
                                    </button>
                                <% } %>
                            </li>
                            <li>
                                <% if(favFilms[3]) { %>
                                    <img src="<%= base_url + favFilms[3].moviePoster %>" alt="movie poster" loading="lazy" style="width: 110px; height: 165px;" data-bs-toggle="modal" data-bs-target="#favFilmModal" class="img-fluid rounded film fav_film" data-position="4">
                                <% } else { %>
                                    <button type="button" class="img-fluid rounded fav_film" data-bs-toggle="modal" data-bs-target="#favFilmModal" data-position="4">
                                        <i class="fa fa-plus-square"></i>
                                    </button>
                                <% } %>
                            </li>
                        </ul>
                    </aside> 
                </section>
            </section>
            <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-primary" value="Upload">Save Changes</button>
            </div>
        </form>

        <!-- Modal -->
        <section class="modal fade" id="favFilmModal" tabindex="-1" aria-labelledby="favFilmModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel"> Pick a Favorite Film</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" style="color: white;"></button>
                    </div>
                    <!-- Modal Body -->
                    <div class="modal-body form-group">
                        <form action="/settings/updateFavMovies/?_method=PUT" method="POST">

                            <label for="favFilm" class="col-form-label">Name of Film:</label>
                            <input type="text" class="form-control" id="favFilm" name="favFilm">
                            <input type="hidden" id="position" name="position">

                        </form>
                    </div>
                </div>
            </div>
        </section>

    </section>
</main>

<script>
    const inputFile = document.getElementById('avatar_upload');
    const fileSelected = document.getElementById('file-name');

    inputFile.addEventListener('change', getFileName);
    
    function getFileName(event) {
        const selectedFile = event.target.files[0];
        
        if (selectedFile) {
            fileSelected.textContent = `${selectedFile.name}`;
        } else {
            fileSelected.textContent = '';
        }
    };

    const favFilmButtons = document.querySelectorAll('.fav_film');

    favFilmButtons.forEach(button => {
        button.addEventListener('click', function() {
            const position = this.getAttribute('data-position');
            document.getElementById('position').value = position;
        });
    });
</script>

<%- include('partials/footer') -%>

